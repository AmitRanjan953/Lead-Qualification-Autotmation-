{
  "name": "FUN CRM",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "Application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Classify the lead. Return ONLY JSON.\\n\\nLead:\\nName: {{$json.Name}}\\nEmail: {{$json['E-Mail']}}\\nPhone: {{$json.Phone}}\\nCompany: {{$json.Company}}\\n\\nRespond strictly in this format:\\n{\\\"score\\\":\\\"Hot|Cold|Warm\\\",\\\"notes\\\":\\\"...\\\"}\"\n        }\n      ]\n    }\n  ]\n}\n",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -64,
        -64
      ],
      "id": "bb439627-0ce3-4cd3-a5c3-c221e6a819e6",
      "name": "HTTP Request",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "Q4KadsSnPC87XsbN",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1EhWc2wbKQLCDpAkOhZ9ZVTiyFKLzF2_K3BhR4Fh7f9w",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1EhWc2wbKQLCDpAkOhZ9ZVTiyFKLzF2_K3BhR4Fh7f9w/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name ": "={{$json[\"Name\"]}}\n",
            "E-Mail": "={{$json[\"E-Mail\"]}}\n",
            "Phone": "={{$json[\"Phone\"]}}\n",
            "Company": "={{$json[\"Company\"]}}\n",
            " Score": "={{$json.score}}",
            "Notes": "={{$json.notes}}",
            "Time Stamp": "={{ new Date().toLocaleString() }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Name ",
              "displayName": "Name ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "E-Mail",
              "displayName": "E-Mail",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Phone",
              "displayName": "Phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": " Score",
              "displayName": " Score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Time Stamp",
              "displayName": "Time Stamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        848,
        -160
      ],
      "id": "4af32269-5743-4b7a-942f-9bdcdc5b3cad",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RpBIFBX4FYEiDihR",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "6190153758",
        "text": "=ðŸ”¥ New HOT Lead Alert!  Name: {{$node[\"Webhook\"].json.body.Name}}\n Email:{{$node[\"Webhook\"].json.body[\"E-Mail\"].replace(/^=/, \"\")}}\nPhone: {{$node[\"Webhook\"].json.body.Phone}}\nCompany:{{$node[\"Webhook\"].json.body.Company}}\n  Score: {{$json.score}} Reason: {{$json.notes}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        464,
        -336
      ],
      "id": "661e5cde-6559-4941-864a-35e66de3aedf",
      "name": "Send a text message",
      "webhookId": "767b0773-02c7-4e9e-b71a-f6673db81cbd",
      "credentials": {
        "telegramApi": {
          "id": "vF9j5dfefsiZo1pu",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json[\"E-Mail\"]}}\n",
        "subject": "Thank You!",
        "emailType": "text",
        "message": "=Hi  {{$json[\"Name\"]}}\n,\nThank you for reaching out! Our team will get in touch with you shortly. \nRegards, Amit",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        464,
        -16
      ],
      "id": "3630fea5-856b-496a-af7a-fa118a364264",
      "name": "Send a message",
      "webhookId": "31d8e377-00b7-4f92-9348-488bdf4f3257",
      "retryOnFail": false,
      "executeOnce": false,
      "credentials": {
        "gmailOAuth2": {
          "id": "YLaAlTvs5qUY5U5Q",
          "name": "Gmail account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "//  Get form data from Google Sheets Trigger\nconst name  = $json[\"Name\"] || \"\";\nconst email = $json[\"E-Mail\"] || \"\";\nconst phone = $json[\"Phone\"] || \"\";\nconst company = $json[\"Company\"] || \"\";\n\n// 1) Read Gemini output\nlet raw = \"\";\ntry {\n    raw = $json.candidates[0].content.parts[0].text || \"\";\n} catch (e) {\n    raw = \"\";\n}\n\n// 2) Clean non-JSON wrappers\nraw = raw\n    .replace(/```json/i, \"\")\n    .replace(/```/g, \"\")\n    .replace(/json\\n/i, \"\")\n    .trim();\n\n// 3) Attempt JSON.parse\nlet score = \"Cold\";\nlet notes = \"AI returned invalid JSON\";\n\ntry {\n    const ai = JSON.parse(raw);\n    score = ai.score || \"Cold\";\n    notes = ai.notes || \"\";\n} catch (e) {\n    // still Cold\n}\n\n// 4) Return clean JSON for next nodes\nreturn [\n  {\n    json: {\n      Name: name,\n      \"E-Mail\": email,\n      Phone: phone,\n      Company: company,\n      score: score,\n      notes: notes,\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -336,
        -64
      ],
      "id": "8db76344-fa46-4e10-926a-d4ad9f987d9e",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59ba368d-cb39-498b-a651-7997ef770ccd",
              "leftValue": "={{$json[\"score\"]}}",
              "rightValue": "Hot",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        208,
        -224
      ],
      "id": "3a7805bb-35d4-4374-95ad-d460b61cfb69",
      "name": "If"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "15dWC0rjdpQk1FEE5dLCrN79mQWnFkJYYcimQrAvlBG0",
          "mode": "list",
          "cachedResultName": "Leadcrm(Responses)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15dWC0rjdpQk1FEE5dLCrN79mQWnFkJYYcimQrAvlBG0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 598989304,
          "mode": "list",
          "cachedResultName": "Form responses 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15dWC0rjdpQk1FEE5dLCrN79mQWnFkJYYcimQrAvlBG0/edit#gid=598989304"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        -624,
        -64
      ],
      "id": "5436642e-1697-40f5-a073-c08549aeb61b",
      "name": "Google Sheets Trigger",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "hGj3RL6uoUi4Ishr",
          "name": "Google Sheets Trigger account"
        }
      }
    }
  ],
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        []
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets Trigger": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Google Sheets Trigger": {
      "documentId": "15dWC0rjdpQk1FEE5dLCrN79mQWnFkJYYcimQrAvlBG0",
      "sheetId": 598989304,
      "lastRevision": 9,
      "lastRevisionLink": "https://docs.google.com/spreadsheets/export?id=15dWC0rjdpQk1FEE5dLCrN79mQWnFkJYYcimQrAvlBG0&revision=9&exportFormat=xlsx"
    }
  },
  "pinData": {},
  "triggerCount": 1,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}